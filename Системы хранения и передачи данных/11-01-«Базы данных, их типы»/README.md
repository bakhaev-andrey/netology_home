# Домашнее задание к занятию "Базы данных, их типы" - `Бахаев Андрей`
---

### Задание 1. СУБД

### Кейс
Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать 
правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для
каждой предметной области. 

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему? 

> **Вопрос 1.1.** Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков.  
> СУБД должна гарантировать целостность и чёткую структуру данных.

**Ответ 1.1.** Я бы разделил контуры.  
Для оперативного учета и транзакций — OLTP (например, PostgreSQL/MS SQL): строгая схема, целостность, версионирование бюджета и контроль изменений.  
Для аналитики, отчетов и прогнозов — отдельный OLAP/DWH (ClickHouse/Greenplum). В аналитике нужна историчность (SCD), быстрые чтения и тяжелые агрегаты.  
Между ними — ETL/CDC, чтобы не нагружать учетную БД аналитическими запросами и отделить write-нагрузку от read-нагрузки.

> **Вопрос 1.1\*.** Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы?

**Ответ 1.1\*.** Я бы смотрел на архитектуру: хеширование часто тормозит из-за того, что его делают синхронно в запросе. Тут помогут async API, очередь задач (Kafka/RabbitMQ) и batch processing. Если это критично по времени ответа — выносим в фоновые воркеры, а в транзакционный контур пишем только факт постановки задачи и статус.

> **Вопрос 1.2.** Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM?  
> СУБД должны быть гибкими и быстрыми.

**Ответ 1.2.** Я бы разделил:  
Лендинги — write-heavy, всплески трафика, минимум связей. Тут уместен event storage (например, Kafka + ClickHouse/Time-series БД) для событий и быстрой записи.  
CRM — транзакционная система с отношениями и отчетами, поэтому SQL (PostgreSQL/MS SQL).  
Данные для рекламных источников лучше формировать из событийного слоя и отдавать через интеграционный сервис. Это позволяет масштабировать сбор событий отдельно от CRM.

> **Вопрос 1.2\*.** Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

**Ответ 1.2\*.** Теоретически можно одной СУБД (PostgreSQL + JSONB), но это компромисс. На больших объемах JSONB ухудшает индексы и планирование, а смешение write-heavy и сложных CRM-запросов приводит к конкуренции за ресурсы. Одной СУБД хватает для небольших проектов; при росте лучше разделять контуры.

> **Вопрос 1.3.** Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

**Ответ 1.3.** Для базы знаний важны иерархии, версии документов, поиск и права доступа. Поэтому я бы смотрел на документную БД или связку SQL + полнотекстовый поиск (например, Elasticsearch). Если структура строгая и важны права доступа — SQL, а для поиска и контента — отдельный индекс.

> **Вопрос 1.3\*.** Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?

**Ответ 1.3\*.** Можно использовать ту же СУБД, что и в 1.1, но лучше вынести в отдельный контур/схему и добавить поисковый индекс. Так основная учетная система не будет зависеть от нагрузки на знания.

> **Вопрос 1.4.** Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

**Ответ 1.4.** Я бы выбрал графовую СУБД (например, Neo4j) для связей и поиска маршрутов, но с учетом, что нужна поддержка shortest path, весов и ограничений (время, стоимость). Если есть геоданные — пригодится PostGIS или отдельный сервис маршрутизации.

> **Вопрос 1.4\*.** Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

**Ответ 1.4\*.** Если закупкам нужны цепочки поставок и связи — можно использовать тот же граф. Если у них другой контекст (каталоги, договоры, счета), лучше отдельная SQL БД и интеграция, чтобы не смешивать модели.

> **Вопрос 1.5\*.** Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

**Ответ 1.5\*.** Одной СУБД можно закрыть небольшую систему, но цена — потеря масштабируемости и сложности: одна БД не одинаково хороша для OLTP, аналитики, графа и событий. На уровне архитектуры это риск. Поэтому на росте лучше разделять сервисы и выбирать СУБД под задачу.


---

### Задание 2. Транзакции

> **Вопрос 2.1.** Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.

**Ответ 2.1.** Пример из 6 шагов:
1) Создается идемпотентная заявка на платеж (payment_id).
2) Проверяется баланс и лимиты, резервируется сумма.
3) Отправляется запрос оператору связи.
4) Получается подтверждение или таймаут.
5) При успехе — commit и окончательное списание, при неуспехе — rollback и снятие резерва.
6) Фиксируется статус и журнал событий для повторной обработки (retry) при сбоях.

> **Вопрос 2.1\*.** Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

**Ответ 2.1\*.** Для автоплатежа есть планировщик, проверка условий, лимитов и дедупликация. Далее процесс как обычно, но с политикой повторов (retry) и защитой от двойного списания по payment_id.


---

### Задание 3. SQL vs NoSQL

> **Вопрос 3.1.** Напишите пять преимуществ SQL-систем по отношению к NoSQL.

**Ответ 3.1.** Пять преимуществ SQL с акцентом на практику:
1) Строгая схема снижает «грязные» данные и упрощает интеграции.
2) Транзакции и ACID важны для финансов и учетных операций.
3) JOIN и сложные запросы дают мощную аналитику без доп. ETL.
4) SQL стандартен, легче найти специалистов и инструменты.
5) Предсказуемость производительности на структурированных данных.

> **Вопрос 3.1\*.** Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

**Ответ 3.1\*.** NewSQL дает ACID и SQL, но масштабируется горизонтально (например, CockroachDB, TiDB). Плюсы — распределенность без потери транзакций. Минусы — сложнее эксплуатация, возможны задержки из-за консенсуса и сеть становится узким местом.

### Задание 4. Кластеры

Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу 
выделено 1000 машин. 

На основе какого критерия будете выбирать тип СУБД и какая модель *распределённых вычислений* 
здесь справится лучше всего и почему?

> **Вопрос 4.1.** На основе какого критерия будете выбирать тип СУБД и какая модель распределённых вычислений здесь справится лучше всего и почему?

**Ответ 4.1.** При наличии кластера из 1000 машин ключевым критерием выбора СУБД является характер нагрузки и масштаб данных. Такой объём ресурсов характерен для задач уровня big data, где требуется обрабатывать огромные массивы данных и выполнять массовые аналитические или вычислительные операции, а не для типовых транзакционных сценариев.

В этом случае оптимальны распределённые аналитические (OLAP/MPP) системы, которые умеют хранить данные распределённо и выполнять вычисления параллельно на большом количестве узлов. Они эффективно используют кластер за счёт того, что каждая машина обрабатывает свою часть данных.

Модель распределённых вычислений строится так, что параллельно выполняются независимые операции (агрегации, статистика, анализ больших массивов данных).
Взаимосвязанные и чувствительные к порядку вычисления выполняются отдельно и контролируемо — либо последовательно, либо по независимым контекстам, чтобы сохранить корректность результатов.

Надёжность обеспечивается за счёт повторяемости вычислений, распределённого хранения данных и возможности повторного выполнения задач при сбоях.
