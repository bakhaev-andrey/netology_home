# Задание №3 - Создание роли для установки и настройки Apache

## Описание
Создана роль `web_apache` для автоматической установки и настройки веб-сервера Apache с динамическим содержимым. Роль устанавливает Apache, создает index.html с характеристиками сервера, настраивает firewall и проверяет доступность сайта.

## Структура роли

### Файлы конфигурации
- [ansible.cfg](./ansible.cfg) - основная конфигурация Ansible
- [inventory.ini](./inventory.ini) - список управляемых хостов
- [site_web.yml](./site_web.yml) - основной плейбук, использующий роль

### Роль web_apache
```
roles/web_apache/
├── defaults/main.yml      # Переменные по умолчанию
├── handlers/main.yml      # Обработчики событий
├── meta/main.yml         # Метаданные роли
├── tasks/main.yml        # Основные задачи
└── templates/index.html.j2 # Jinja2-шаблон для index.html
```

## Функциональность роли

### Основные задачи:
1. **Установка Apache** (httpd/apache2 в зависимости от ОС)
2. **Создание динамического index.html** с характеристиками сервера:
   - CPU (количество ядер)
   - RAM (объем памяти)
   - Первый HDD (размер диска)
   - IP-адрес
3. **Настройка порта 8080** (для избежания конфликта с nginx)
4. **Настройка firewall** (открытие порта 8080)
5. **Запуск и автозагрузка** Apache
6. **Проверка доступности** веб-сайта (статус 200)

### Handler:
- **restart apache** - перезапуск Apache при изменении конфигурации

## Результаты выполнения

### Выполнение плейбука с ролью
![Плейбук 3.1](./Playbook%203.1.png)
![Плейбук 3.2](./Playbook%203.2.png)

**Результат выполнения:**
- ✅ Apache успешно установлен
- ✅ Создан index.html с характеристиками хоста
- ✅ Настроен порт 8080 (без конфликта с nginx)
- ✅ Открыт порт 8080 в UFW firewall
- ✅ Apache запущен и добавлен в автозагрузку
- ✅ Handler перезапустил Apache
- ✅ Проверка доступности сайта прошла успешно

### Отображение сайта в браузере
Сайт доступен по адресу: `http://34.40.105.112:8080`

**Отображаемая информация:**
- **CPU:** 1 ядро
- **RAM:** 7939 MB
- **Первый HDD:** loop1 - 73.90 MB
- **IP-адрес:** 10.156.0.3

## Технические особенности

### Использованные технологии:
- **Jinja2-шаблоны** для динамического содержимого
- **Ansible Facts** для получения характеристик системы
- **Handlers** для перезапуска сервисов только при необходимости
- **Условные выражения** для поддержки разных ОС (RedHat/Debian)

### Модули Ansible (без shell/command):
- `package` - установка пакетов
- `template` - создание файлов из шаблонов
- `lineinfile` - редактирование конфигурационных файлов
- `firewalld`/`ufw` - настройка firewall
- `service` - управление сервисами
- `uri` - проверка HTTP-доступности

## Итоги выполнения
Роль успешно создана и протестирована. Все требования задания выполнены:
- ✅ Установка Apache без использования shell/command
- ✅ Динамический index.html с системной информацией
- ✅ Использование Jinja2-шаблонов и Ansible Facts
- ✅ Handler для перезапуска Apache
- ✅ Настройка firewall и автозагрузки
- ✅ Проверка доступности сайта (статус 200)
- ✅ Сайт успешно отображается в браузере